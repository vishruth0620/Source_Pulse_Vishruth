from deepeval.test_case import LLMTestCase
from deepeval.dataset import EvaluationDataset
from deepeval import assert_test
from deepeval.metrics import (ContextualPrecisionMetric,ContextualRecallMetric,ContextualRelevancyMetric)
from deepeval import evaluate




original_dataset = [ 
    #First Test Case
    {
        "input": "What are the family planning services funded through the HHSC Family Planning Program?",
        "actual_output": "The family planning services funded through the HHSC Family Planning Program include: Health history and physical examinations, Counseling and education, Laboratory testing, Provision of a contraceptive method, Pregnancy tests, Sexually transmitted infection screenings and treatment, Referrals for additional services as needed, Immunizations, Breast and cervical cancer screening and diagnostic services, Prenatal services, Other services subject to available funding.",
        "expected_output": "The family planning services needed are Health history and physical Counseling and education Laboratory testing, Provision of a contraceptive method, Pregnancy tests, Sexually transmitted infection screenings and treatment, Referrals for additional services, as needed, Immunizations,Breast and cervical cancer screening and diagnostic services,Prenatal services, and Other services subject to available funding.",
        "context": ['Subsection 1.1, â€œFamily Planning Overviewâ€ in the Gynecological, Obstetrics, and Family Planning Title XIX Services Handbook (Vol. 2, Provider Handbooks) for more information about family planning funding sources, guidelines for family planning providers, and family planning services for undocumented aliens and legalized aliens. This section contains information about family planning services funded through the HHSC Family Planning Program funding source, including: â€¢ Health history and physical; â€¢ Counseling and education; â€¢ Laboratory testing; â€¢ Provision of a contraceptive method; â€¢ Pregnancy tests; Sexually transmitted infection screenings and treatment; â€¢ Referrals for additional services, as needed; â€¢ Immunizations; â€¢ Breast and cervical cancer screening and diagnostic services; â€¢ Prenatal services; and â€¢ Other services subject to available funding',
                    'methodologies, client copayment guidelines, and covered services may differ for each funding source. Family planning funding cannot be used for elective abortion services. • Title XIX funds are available for family planning services provided to Texas Medicaid clients. TMHP processes Title XIX claims and reimburses eligible services on a fee-for-service basis for family planning providers and a prospective payment system basis for FQHC and RHC providers. • HHSC Family Planning Program contracts annually with family planning providers. TMHP processes claims and reimburses providers for services to eligible clients according to the individ- ually granted funds.',
                    '2 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Agencies that submit claims for HHSC Family Planning Program Services must have a contract with HHSC. The HHSC Family Planning Program determines client eligibility and benefits. Refer to the HHSC Family Planning Program Policy Manual for specific eligibility, services, and policy information at www.hhs.texas.gov/laws-regulations/handbooks/fpp/family-planning-program-policy-manual. Refer to: “Section 1: Provider Enrollment and Responsibilities” (Vol. 1, General Information) for more information about enrollment procedures. Subsection 2.1, “Title XIX Provider Enrollment” in the Gynecological, Obstetrics, and Family Planning Title XIX Services Handbook (Vol. 2, Provider Handbooks).',
                    'planning services provided to Healthy Texas Women (HTW) clients. TMHP processes HTW claims and reimburses eligible services on a fee-for- service basis for family planning providers and a prospective payment system basis for FQHC and RHC providers. 1.1.1 The following guidelines apply for all family planning services: • Family planning services may be provided by a physician or under the direction of a physician, not necessarily personal supervision. A physician provides direction for family planning services through written standing delegation orders and medical protocols. The physician is not required to be on the premises for the provision of family planning services by a registered nurse (RN), physi- cians assistant (PA), nurse practitioner (NP), clinical nurse specialist (CNS), or certified nurse midwife (CNM).',
                    'Family planning services are preventive health, medical, counseling, and educational services that assist individuals in managing their fertility and achieving optimal reproductive and general health. Title XIX services include: • Family planning annual exams • Other family planning office or outpatient visits • Laboratory services • Radiology services • Contraceptive devices and related procedures • Drugs and supplies • Medical counseling and education Sterilization and sterilization-related procedures (i.e., tubal implants, tubal ligation, vasectomy, and anesthesia for sterilization) Providers must use one of the following diagnosis codes in conjunction with all family planning proce- dures and services:'
        ],
        "retrieval_context": ['Subsection 1.1, â€œFamily Planning Overviewâ€ in the Gynecological, Obstetrics, and Family Planning Title XIX Services Handbook (Vol. 2, Provider Handbooks) for more information about family planning funding sources, guidelines for family planning providers, and family planning services for undocumented aliens and legalized aliens. This section contains information about family planning services funded through the HHSC Family Planning Program funding source, including: â€¢ Health history and physical; â€¢ Counseling and education; â€¢ Laboratory testing; â€¢ Provision of a contraceptive method; â€¢ Pregnancy tests; Sexually transmitted infection screenings and treatment; â€¢ Referrals for additional services, as needed; â€¢ Immunizations; â€¢ Breast and cervical cancer screening and diagnostic services; â€¢ Prenatal services; and â€¢ Other services subject to available funding',
                    'methodologies, client copayment guidelines, and covered services may differ for each funding source. Family planning funding cannot be used for elective abortion services. • Title XIX funds are available for family planning services provided to Texas Medicaid clients. TMHP processes Title XIX claims and reimburses eligible services on a fee-for-service basis for family planning providers and a prospective payment system basis for FQHC and RHC providers. • HHSC Family Planning Program contracts annually with family planning providers. TMHP processes claims and reimburses providers for services to eligible clients according to the individ- ually granted funds.',
                    '2 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Agencies that submit claims for HHSC Family Planning Program Services must have a contract with HHSC. The HHSC Family Planning Program determines client eligibility and benefits. Refer to the HHSC Family Planning Program Policy Manual for specific eligibility, services, and policy information at www.hhs.texas.gov/laws-regulations/handbooks/fpp/family-planning-program-policy-manual. Refer to: “Section 1: Provider Enrollment and Responsibilities” (Vol. 1, General Information) for more information about enrollment procedures. Subsection 2.1, “Title XIX Provider Enrollment” in the Gynecological, Obstetrics, and Family Planning Title XIX Services Handbook (Vol. 2, Provider Handbooks).',
                    'planning services provided to Healthy Texas Women (HTW) clients. TMHP processes HTW claims and reimburses eligible services on a fee-for- service basis for family planning providers and a prospective payment system basis for FQHC and RHC providers. 1.1.1 The following guidelines apply for all family planning services: • Family planning services may be provided by a physician or under the direction of a physician, not necessarily personal supervision. A physician provides direction for family planning services through written standing delegation orders and medical protocols. The physician is not required to be on the premises for the provision of family planning services by a registered nurse (RN), physi- cians assistant (PA), nurse practitioner (NP), clinical nurse specialist (CNS), or certified nurse midwife (CNM).',
                    'Family planning services are preventive health, medical, counseling, and educational services that assist individuals in managing their fertility and achieving optimal reproductive and general health. Title XIX services include: • Family planning annual exams • Other family planning office or outpatient visits • Laboratory services • Radiology services • Contraceptive devices and related procedures • Drugs and supplies • Medical counseling and education Sterilization and sterilization-related procedures (i.e., tubal implants, tubal ligation, vasectomy, and anesthesia for sterilization) Providers must use one of the following diagnosis codes in conjunction with all family planning proce- dures and services:'
        ],
    },
    #Fourth Test Case
    { 
        "input": "Why do Medicaid physicians require to have authorization for non-emergency situations?",
        "actual_output": "The sources that TPR (Third Party Resources) includes for payments for Texas Medicaid are: Other health insurance including assignable indemnity contracts  Health maintenance organization (HMO) Public health programs available to clients with Medicaid such as Medicare and Tricare  Profit and nonprofit health plans.",
        "expected_output": "TPR includes payments from any of the following sources: Other health insurance including assignable indemnity contract, Health maintenance organization (HMO), Public health programs available to clients with Medicaid such as Medicare and Tricare, Profit and nonprofit health plan, Employment-related health insurance, Self-insured plans, Casualty coverage resulting from an accidental injury such as automobile or property insurance, (including no-fault insurance); No-fault automobile insurance such as personal injury protection, (PIP) and automobile medical insurance, Liability insurance, Life insurance policies, trust funds, cancer policies, or other supplemental policies, Workersâ€™ Compensation, Medical support from absent parents, Court judgments or settlements from a liability insurer, First party probate-estate recoveries, Other federal programs unless excluded by statute, Other liable third parties.",
        "context": ['According to Human Resource Code (HRC) §32.024 (t), a Medicaid-enrolled physician, nursing facility, health-care provider, or other responsible party is required to obtain authorization before an ambulance is used to transport a client in circumstances not involving an emergency. Providers requesting prior authorization must document whether the client is currently an inpatient in a hospital when requesting prior authorization. Prior authorization will not be approved if the provider indicates the client is currently an inpatient in a hospital, except for one-time transports immediately after the client’s discharge from the hospital. Prior authorization requests may be submitted to the TMHP Prior Authorization Department by mail, fax, or the electronic portal. Prescribing or ordering providers, dispensing providers, clients’ responsible adults, and clients may sign prior authorization forms and supporting documentation using electronic or wet signatures.',
                    'All emergency out-of-state (air, ground, and water) transports require authorization before the transport is considered for payment. Prior authorization for emergency transport is required for out-of-state providers with the exception of those providers located within 200 miles of the Texas border. 6 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Refer to: Subsection 2.6, “Out-of-State Medicaid Providers” in “Section 2: Texas Medicaid Fee-for-Service Reimbursement” (Vol. 1, General Information) for additional information on providers who are not considered out-of-state providers. To initiate the prior authorization process, providers must call 1-800-540-0694. Texas Medicaid & Healthcare Partnership (TMHP) is responsible for processing prior authorization requests for all Medicaid clients.',
                    'If a client’s primary coverage is private insurance and Medicaid is secondary, prior authorization is required for Medicaid reimbursement. If the primary coverage is Medicare, Medicare approves the service, and Medicaid is secondary, prior authorization is not required. TMHP will pay only the coinsurance or deductible according to current payment guidelines. If Medicare denied the service, then Medicaid prior authorization is required. TMHP must receive a prior authorization request within 30 days of the date of Medicare’s final disposition. The Medicare Remittance Advice Notice (MRAN) containing Medicare’s final disposition must accompany the prior authorization request. If the service is a Medicaid-only service, prior authorization is required within three business days of the DOS. The provider must contact the TMHP Home Health Services Prior Authorization Department within three business days of the DOS to obtain prior authorization for DME and medical supplies.',
                    'For nonemergency ambulance transportation services rendered to a client, ambulance providers may coordinate the nonemergency ambulance prior authorization request between the requesting provider, which may include a physician, nursing facility, healthcare provider, or other responsible party. Ambulance providers may assist in providing necessary information such as their National Provider Identifier (NPI) number, fax number, and business address to the requesting provider. However, the Non-emergency Ambulance Prior Authorization Request form must be signed, dated, and submitted by the Medicaid-enrolled requesting provider, not the ambulance provider. Refer to: Subsection 5.1.8, “Prior Authorization for Nonemergency Ambulance Transport” in “Section 5: Fee-for-Service Prior Authorizations” (Vol. 1, General Information) for more information about nonemergency ambulance transport prior authorization requests and appeals.',
                    'To avoid unnecessary denials, the physician must provide correct and complete information, including documentation of medical necessity for the service(s) requested. The physician must maintain documentation of medical necessity in the client’s medical record. The requesting therapy provider may be asked for additional information to clarify or complete a request. Therapy services, regardless of place or provider, occurring after the initial evaluation, require prior authorization. Prior authorization requests may not exceed a 60 day period. Prior authorization (PA) requests must be received no later than five business days from the date therapy treatments following the evaluation are initiated. Requests received after the five-business-day period will be denied for dates of service that occurred before the date that the PA request is received.'
        ],
        "retrieval_context": ['According to Human Resource Code (HRC) §32.024 (t), a Medicaid-enrolled physician, nursing facility, health-care provider, or other responsible party is required to obtain authorization before an ambulance is used to transport a client in circumstances not involving an emergency. Providers requesting prior authorization must document whether the client is currently an inpatient in a hospital when requesting prior authorization. Prior authorization will not be approved if the provider indicates the client is currently an inpatient in a hospital, except for one-time transports immediately after the client’s discharge from the hospital. Prior authorization requests may be submitted to the TMHP Prior Authorization Department by mail, fax, or the electronic portal. Prescribing or ordering providers, dispensing providers, clients’ responsible adults, and clients may sign prior authorization forms and supporting documentation using electronic or wet signatures.',
                              'All emergency out-of-state (air, ground, and water) transports require authorization before the transport is considered for payment. Prior authorization for emergency transport is required for out-of-state providers with the exception of those providers located within 200 miles of the Texas border. 6 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Refer to: Subsection 2.6, “Out-of-State Medicaid Providers” in “Section 2: Texas Medicaid Fee-for-Service Reimbursement” (Vol. 1, General Information) for additional information on providers who are not considered out-of-state providers. To initiate the prior authorization process, providers must call 1-800-540-0694. Texas Medicaid & Healthcare Partnership (TMHP) is responsible for processing prior authorization requests for all Medicaid clients.',
                              'If a client’s primary coverage is private insurance and Medicaid is secondary, prior authorization is required for Medicaid reimbursement. If the primary coverage is Medicare, Medicare approves the service, and Medicaid is secondary, prior authorization is not required. TMHP will pay only the coinsurance or deductible according to current payment guidelines. If Medicare denied the service, then Medicaid prior authorization is required. TMHP must receive a prior authorization request within 30 days of the date of Medicare’s final disposition. The Medicare Remittance Advice Notice (MRAN) containing Medicare’s final disposition must accompany the prior authorization request. If the service is a Medicaid-only service, prior authorization is required within three business days of the DOS. The provider must contact the TMHP Home Health Services Prior Authorization Department within three business days of the DOS to obtain prior authorization for DME and medical supplies.',
                              'For nonemergency ambulance transportation services rendered to a client, ambulance providers may coordinate the nonemergency ambulance prior authorization request between the requesting provider, which may include a physician, nursing facility, healthcare provider, or other responsible party. Ambulance providers may assist in providing necessary information such as their National Provider Identifier (NPI) number, fax number, and business address to the requesting provider. However, the Non-emergency Ambulance Prior Authorization Request form must be signed, dated, and submitted by the Medicaid-enrolled requesting provider, not the ambulance provider. Refer to: Subsection 5.1.8, “Prior Authorization for Nonemergency Ambulance Transport” in “Section 5: Fee-for-Service Prior Authorizations” (Vol. 1, General Information) for more information about nonemergency ambulance transport prior authorization requests and appeals.',
                              'To avoid unnecessary denials, the physician must provide correct and complete information, including documentation of medical necessity for the service(s) requested. The physician must maintain documentation of medical necessity in the client’s medical record. The requesting therapy provider may be asked for additional information to clarify or complete a request. Therapy services, regardless of place or provider, occurring after the initial evaluation, require prior authorization. Prior authorization requests may not exceed a 60 day period. Prior authorization (PA) requests must be received no later than five business days from the date therapy treatments following the evaluation are initiated. Requests received after the five-business-day period will be denied for dates of service that occurred before the date that the PA request is received.'
        ],
    },
    #Sixth Test Case
    {
        "input": "What are the following sources that TPR includes payments for Texas Medicaid?",
        "actual_output": "Medicaid physicians require authorization for non-emergency situations primarily to ensure that the treatments or services provided are medically necessary and cost-effective. This process helps manage healthcare costs and prevents unnecessary procedures, aligning with Medicaid's goal to provide efficient and appropriate care to its beneficiaries. Additionally, prior authorization serves as a checkpoint to review the appropriateness of the requested service, based on clinical criteria and patient needs, thereby safeguarding patient health and optimizing resource allocation.",
        "expected_output": "Providers requesting prior authorization must document whether the client is currently an inpatient in a hospital when requesting prior authorization. Prior authorization will not be approved if the provider indicates the client is currently an inpatient in a hospital, except for one-time transports immediately after the clientâ€™s discharge from the hospital. Prior authorization requests may be submitted to the TMHP Prior Authorization Department by mail, fax, or the electronic portal. Prescribing or ordering providers, dispensing providers, clientsâ€™ responsible adults, and clients may sign prior authorization forms and supporting documentation using electronic or wet signatures.For nonemergency ambulance transportation services rendered to a client, ambulance providers may coordinate the nonemergency ambulance prior authorization request between the requesting provider, which may include a physician, nursing facility, healthcare provider, or other responsible party. Ambulance providers may assist in providing necessary information such as their National Provider Identifier (NPI) number, fax number, and business address to the requesting provider. However, the Non-emergency Ambulance Prior Authorization Request form must be signed, dated, and submitted by the Medicaid-enrolled requesting provider, not the ambulance provider.",
        "context": ['Texas Medicaid & Healthcare Partnership Third Party Resources Unit PO Box 202948 Austin, TX 78720-2948 3 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Medicaid-eligible clients may not be held responsible for billed charges that are in excess of the TPR payment for services covered by Texas Medicaid. If the TPR pays less than the Medicaid-allowable amount for covered services, the provider should submit a claim to TMHP for any additional allowable amount. 8.3 A provider who furnishes services and participates in Texas Medicaid may not refuse to furnish services to an eligible client because of a third party’s potential liability for payment of the services. TPR includes payments from any of the following sources: • Other health insurance including assignable indemnity contract • Health maintenance organization (HMO) • Public health programs available to clients with Medicaid such as Medicare and Tricare • Profit and nonprofit health plan',
                    '15 2 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. 8.1 Texas Medicaid Third Party Liability program recovers payments from third parties that are responsible for paying towards a medical claim for services rendered to a Texas Medicaid client. A third party resource (TPR) is the entity, individual, or other source (other than Medicaid, Medicaid managed care organizations (MCOs), Medicaid managed care dental plans, the client, non-TPR sources, or Medicare) that is legally responsible for paying the medical claims of Texas Medicaid clients. The Third Party Liability program helps reduce Medicaid costs by shifting claims expenses to third party payers.',
                    'If providers have questions about others not listed, they may contact a provider relations representative. Note: Claims for clients who are seeking disability determination must be submitted to HHSC for consideration of reimbursement. Refer to the HHS website at www.hhs.texas.gov/ for additional information about disability determinations and claims filing. Denied claims or services that are not a benefit of Medicaid may be submitted to non-TPR sources. If a claim is submitted inadvertently to a non-TPR source listed above before submission to TMHP, the claim may be submitted to TMHP within the filing deadlines. Refer to: Subsection 6.1.4, “Claims Filing Deadlines” in “Section 6: Claims Filing” (Vol. 1, General Information). If a non-TPR source erroneously makes a payment for a dual-eligible client for services also covered by Medicaid, the payment is refunded to the non-TPR source. 5 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED.'
                    '8.4 A non-TPR is secondary to Texas Medicaid and may only pay benefits after Texas Medicaid. Non-TPR sources include, but are not limited to, accident-only policies, managed care plans, Indigent Health Care, and Medicaid/Children’s Health Insurance Program (CHIP). The provider bills TMHP directly within 95 days from the date of service. However, if a non-TPR is billed first, TMHP must receive the claim within 95 days of the claim disposition by the other entity. Note: The provider must submit a copy of the disposition with the claim. 8.5 Inpatient and outpatient hospitals and providers enrolled in Texas Medicaid are required to inform TMHP about circumstances that may result in third party liability for health-care claims. After receiving this information, TMHP pursues reimbursement from responsible third parties.'
        ],
        "retrieval_context": ['Texas Medicaid & Healthcare Partnership Third Party Resources Unit PO Box 202948 Austin, TX 78720-2948 3 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Medicaid-eligible clients may not be held responsible for billed charges that are in excess of the TPR payment for services covered by Texas Medicaid. If the TPR pays less than the Medicaid-allowable amount for covered services, the provider should submit a claim to TMHP for any additional allowable amount. 8.3 A provider who furnishes services and participates in Texas Medicaid may not refuse to furnish services to an eligible client because of a third party’s potential liability for payment of the services. TPR includes payments from any of the following sources: • Other health insurance including assignable indemnity contract • Health maintenance organization (HMO) • Public health programs available to clients with Medicaid such as Medicare and Tricare • Profit and nonprofit health plan',
                    '15 2 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. 8.1 Texas Medicaid Third Party Liability program recovers payments from third parties that are responsible for paying towards a medical claim for services rendered to a Texas Medicaid client. A third party resource (TPR) is the entity, individual, or other source (other than Medicaid, Medicaid managed care organizations (MCOs), Medicaid managed care dental plans, the client, non-TPR sources, or Medicare) that is legally responsible for paying the medical claims of Texas Medicaid clients. The Third Party Liability program helps reduce Medicaid costs by shifting claims expenses to third party payers.',
                    'If providers have questions about others not listed, they may contact a provider relations representative. Note: Claims for clients who are seeking disability determination must be submitted to HHSC for consideration of reimbursement. Refer to the HHS website at www.hhs.texas.gov/ for additional information about disability determinations and claims filing. Denied claims or services that are not a benefit of Medicaid may be submitted to non-TPR sources. If a claim is submitted inadvertently to a non-TPR source listed above before submission to TMHP, the claim may be submitted to TMHP within the filing deadlines. Refer to: Subsection 6.1.4, “Claims Filing Deadlines” in “Section 6: Claims Filing” (Vol. 1, General Information). If a non-TPR source erroneously makes a payment for a dual-eligible client for services also covered by Medicaid, the payment is refunded to the non-TPR source. 5 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED.'
                    '8.4 A non-TPR is secondary to Texas Medicaid and may only pay benefits after Texas Medicaid. Non-TPR sources include, but are not limited to, accident-only policies, managed care plans, Indigent Health Care, and Medicaid/Children’s Health Insurance Program (CHIP). The provider bills TMHP directly within 95 days from the date of service. However, if a non-TPR is billed first, TMHP must receive the claim within 95 days of the claim disposition by the other entity. Note: The provider must submit a copy of the disposition with the claim. 8.5 Inpatient and outpatient hospitals and providers enrolled in Texas Medicaid are required to inform TMHP about circumstances that may result in third party liability for health-care claims. After receiving this information, TMHP pursues reimbursement from responsible third parties.'
        ],
    },
    #Eighth Test Case
    {
        "input": "Why does a Third Party Liability support to provide payments of managed care to Texas Medicaid Clients?",
        "actual_output": "The Third Party Liability (TPL) program supports the provision of payments for managed care to Texas Medicaid clients by recovering payments from third parties that are legally responsible for paying medical claims. This process helps reduce Medicaid costs by shifting the financial responsibility for these claims to the appropriate third party payers, rather than having them solely funded by Medicaid. This ensures that Medicaid can allocate its resources more efficiently and sustainably, supporting the overall management and provision of care to its clients.",
        "expected_output": "They can limit the amount additional costs that Texas Medicaid offers to clients when relying on a TPR to provide claims when recovering any health insurance and commerical MCOs.",
        "context": ['15 2 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. 8.1 Texas Medicaid Third Party Liability program recovers payments from third parties that are responsible for paying towards a medical claim for services rendered to a Texas Medicaid client. A third party resource (TPR) is the entity, individual, or other source (other than Medicaid, Medicaid managed care organizations (MCOs), Medicaid managed care dental plans, the client, non-TPR sources, or Medicare) that is legally responsible for paying the medical claims of Texas Medicaid clients. The Third Party Liability program helps reduce Medicaid costs by shifting claims expenses to third party payers.',
                    'Federal and state laws require the use of Medicaid funds for the payment of most medical services only after all reasonable measures have been made to use a client’s TPR or other insurance. To the extent allowed by federal law, a health-care service provider must seek reimbursement from available third party insurance that the provider knows about or should know about before billing Texas Medicaid. Medicaid pays only after the third party has met its legal obligation to pay (i.e., Medicaid is the payer of last resort). All claims submitted for Texas Medicaid payment for clients with other insurance coverage must reference the information, regardless of whether a copy of the explanation of benefits (EOB) from the insurance company is submitted with the claim.',
                    'If payment is immediately available from a known third party such as Workers’ Compensation or Personal Injury Protection (PIP) automobile insurance, that responsible party must be billed before Medicaid, and the insurance disposition information must be filed with the Medicaid claim. If the third party payment is substantially delayed because of contested liability or unresolved legal action, a claim may be submitted to TMHP for consideration of payment. TMHP processes the liability-related claim and pursues reimbursement directly from the potentially liable party on a postpayment basis. Include the following information on these claims: • Name and address of the liable third party • Policy and claim number • Description of the accident including location, date, time, and alleged cause • Reason for delayed payment by the liable third party',
                    'Texas Medicaid & Healthcare Partnership Third Party Resources Unit PO Box 202948 Austin, TX 78720-2948 3 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Medicaid-eligible clients may not be held responsible for billed charges that are in excess of the TPR payment for services covered by Texas Medicaid. If the TPR pays less than the Medicaid-allowable amount for covered services, the provider should submit a claim to TMHP for any additional allowable amount. 8.3 A provider who furnishes services and participates in Texas Medicaid may not refuse to furnish services to an eligible client because of a third party’s potential liability for payment of the services. TPR includes payments from any of the following sources: • Other health insurance including assignable indemnity contract • Health maintenance organization (HMO) • Public health programs available to clients with Medicaid such as Medicare and Tricare • Profit and nonprofit health plan',
                    '8.4 A non-TPR is secondary to Texas Medicaid and may only pay benefits after Texas Medicaid. Non-TPR sources include, but are not limited to, accident-only policies, managed care plans, Indigent Health Care, and Medicaid/Children’s Health Insurance Program (CHIP). The provider bills TMHP directly within 95 days from the date of service. However, if a non-TPR is billed first, TMHP must receive the claim within 95 days of the claim disposition by the other entity. Note: The provider must submit a copy of the disposition with the claim. 8.5 Inpatient and outpatient hospitals and providers enrolled in Texas Medicaid are required to inform TMHP about circumstances that may result in third party liability for health-care claims. After receiving this information, TMHP pursues reimbursement from responsible third parties.'
        ],
        "retrieval_context": ['15 2 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. 8.1 Texas Medicaid Third Party Liability program recovers payments from third parties that are responsible for paying towards a medical claim for services rendered to a Texas Medicaid client. A third party resource (TPR) is the entity, individual, or other source (other than Medicaid, Medicaid managed care organizations (MCOs), Medicaid managed care dental plans, the client, non-TPR sources, or Medicare) that is legally responsible for paying the medical claims of Texas Medicaid clients. The Third Party Liability program helps reduce Medicaid costs by shifting claims expenses to third party payers.',
                              'Federal and state laws require the use of Medicaid funds for the payment of most medical services only after all reasonable measures have been made to use a client’s TPR or other insurance. To the extent allowed by federal law, a health-care service provider must seek reimbursement from available third party insurance that the provider knows about or should know about before billing Texas Medicaid. Medicaid pays only after the third party has met its legal obligation to pay (i.e., Medicaid is the payer of last resort). All claims submitted for Texas Medicaid payment for clients with other insurance coverage must reference the information, regardless of whether a copy of the explanation of benefits (EOB) from the insurance company is submitted with the claim.',
                              'If payment is immediately available from a known third party such as Workers’ Compensation or Personal Injury Protection (PIP) automobile insurance, that responsible party must be billed before Medicaid, and the insurance disposition information must be filed with the Medicaid claim. If the third party payment is substantially delayed because of contested liability or unresolved legal action, a claim may be submitted to TMHP for consideration of payment. TMHP processes the liability-related claim and pursues reimbursement directly from the potentially liable party on a postpayment basis. Include the following information on these claims: • Name and address of the liable third party • Policy and claim number • Description of the accident including location, date, time, and alleged cause • Reason for delayed payment by the liable third party',
                              'Texas Medicaid & Healthcare Partnership Third Party Resources Unit PO Box 202948 Austin, TX 78720-2948 3 CPT ONLY - COPYRIGHT 2022 AMERICAN MEDICAL ASSOCIATION. ALL RIGHTS RESERVED. Medicaid-eligible clients may not be held responsible for billed charges that are in excess of the TPR payment for services covered by Texas Medicaid. If the TPR pays less than the Medicaid-allowable amount for covered services, the provider should submit a claim to TMHP for any additional allowable amount. 8.3 A provider who furnishes services and participates in Texas Medicaid may not refuse to furnish services to an eligible client because of a third party’s potential liability for payment of the services. TPR includes payments from any of the following sources: • Other health insurance including assignable indemnity contract • Health maintenance organization (HMO) • Public health programs available to clients with Medicaid such as Medicare and Tricare • Profit and nonprofit health plan',
                              '8.4 A non-TPR is secondary to Texas Medicaid and may only pay benefits after Texas Medicaid. Non-TPR sources include, but are not limited to, accident-only policies, managed care plans, Indigent Health Care, and Medicaid/Children’s Health Insurance Program (CHIP). The provider bills TMHP directly within 95 days from the date of service. However, if a non-TPR is billed first, TMHP must receive the claim within 95 days of the claim disposition by the other entity. Note: The provider must submit a copy of the disposition with the claim. 8.5 Inpatient and outpatient hospitals and providers enrolled in Texas Medicaid are required to inform TMHP about circumstances that may result in third party liability for health-care claims. After receiving this information, TMHP pursues reimbursement from responsible third parties.'
        ],
    },
]


contextual_precision = ContextualPrecisionMetric(model="gpt-4")
contextual_recall = ContextualRecallMetric(model="gpt-4")
contextual_relevancy = ContextualRelevancyMetric(model="gpt-4")

test_cases = []
for datapoint in original_dataset:
    input = datapoint.get("input", None)
    actual_output = datapoint.get("actual_output", None)
    expected_output = datapoint.get("expected_output", None)
    context = datapoint.get("context", None)
    retrieval_context = datapoint.get("retrieval_context", None)

    test_case = LLMTestCase(
        input=input,
        actual_output=actual_output,
        expected_output=expected_output,
        context=context,
        retrieval_context=retrieval_context
    )
    test_cases.append(test_case)

dataset = EvaluationDataset(test_cases=test_cases) #setup the test cases to evaluate
dataset.push(alias="MITA_CC", overwrite=True) #Push the test cases to ConfidentAI
evaluate(dataset,[contextual_precision,contextual_recall,contextual_relevancy]) #Evaluate the context metrics